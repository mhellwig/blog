(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var Author={init:function(name,email){this.name=name;this.email=email},gravatar:function(){return"http://www.gravatar.com/avatar/"+_emailHash(this.email)+"?s=48"},save:function(){localStorage.setItem("author",JSON.stringify(this))},fetch:function(){var raw=localStorage.getItem("author")?JSON.parse(localStorage.getItem("author")):{name:"",email:""};this.init(raw.name,raw.email)},validate:function(){var errors=[];["name","email"].forEach(function(property){if(!this[property]){errors.push({field:property,message:"Please enter "+property})}}.bind(this));return errors}};var _emailHash=function(email){return md5(email)};module.exports=Author},{}],2:[function(require,module,exports){md5=require("./md5");var Comment={init:function(author,text,timestamp){this.text=text;this.author=author;this.timestamp=timestamp;this.errors=[]},validate:function(){this.errors=this.author.validate();if(!this.text){this.errors.push({field:"text",message:"Please enter text"})}return this.errors.length?false:true},render:function(){return"<div class='ec-comment'>"+"<div class='ec-comment__avatar'>"+"<img src='"+this.author.gravatar()+"'>"+"</div>"+"<div class='ec-comment__body'>"+"<h4 class=''>"+this.author.name+"<small> on "+_renderDate(this.timestamp)+"</small>"+"</h4>"+"<p class=''>"+this.text+"</p>"+"</div>"+"</div>"}};var _renderDate=function(timestamp){var date=new Date(timestamp);return date.toDateString()+" at "+date.getHours()+":"+date.getMinutes()};module.exports=Comment},{"./md5":6}],3:[function(require,module,exports){var Comment=require("./comment.js");var Author=require("./author.js");var CommentList={init:function(form,renderCallback){var list=document.createElement("div");list.setAttribute("id","EC-list");list.setAttribute("class","ec-list");this.form=form;this.list=form.parentNode.appendChild(list);this.renderCallback=renderCallback;this.path=window.location.href;this.comments=this.load();this.render()},load:function(){var rawComments=localStorage.getItem(this.path)||"[]";return _parse(JSON.parse(rawComments))},fetch:function(){var rawComments=localStorage.getItem(this.path)||"[]";return JSON.parse(rawComments)},save:function(){localStorage.setItem(this.path,this.stringify())},render:function(target){var count=this.comments.length;this.list.innerHTML=this.buildHTML();this.form.firstChild.innerHTML=count+" "+_commentString(count)},stringify:function(){return JSON.stringify(this.comments.map(function(item){return{text:item.text,name:item.author.name,email:item.author.email,timestamp:item.timestamp}}))},getHeight:function(){return this.list.clientHeight},buildHTML:function(){var comments=this.comments.slice();return comments.reduce(function(total,comment){return total+comment.render()},"")}};var _commentString=function(count){return count===1?"comment":"comments"};var _parse=function(srcComments){return srcComments.map(function(comment){var c=Object.create(Comment);var a=Object.create(Author);a.init(comment.name,comment.email);c.init(a,comment.text,comment.timestamp);return c})};module.exports=CommentList},{"./author.js":1,"./comment.js":2}],4:[function(require,module,exports){var CommentList=require("./comment_list.js");var Form=require("./form.js");var App={init:function(){this.entry=document.getElementById("echochamber");this.attachIframe();this.iframeDoc=this.iframe.contentWindow.document;this.pageStyles=_getBasicStyles(this.entry.parentNode);this.form=Object.create(Form);this.form.init(this.iframe);this.loadStylesheet()},attachIframe:function(){this.iframe=document.createElement("iframe");this.iframe.style.width="100%";this.iframe.style.overflow="hidden";this.iframe.style.border="none";this.iframe.style.opacity=0;this.iframe.scrolling=false;this.iframe.style.transition="opacity .5s";this.iframe.setAttribute("horizontalscrolling","no");this.iframe.setAttribute("verticalscrolling","no");this.entry.parentNode.insertBefore(this.iframe,this.entry)},loadStylesheet:function(){var link=document.createElement("link"),img=document.createElement("img"),body=document.body,head=this.iframeDoc.getElementsByTagName("head")[0],cssURL=EchoChamber.host+"/main.css";link.rel="stylesheet";link.type="text/css";link.href=cssURL;head.appendChild(link);body.appendChild(img);img.src=cssURL;img.onerror=function(){body.removeChild(img);_applyPageStyles(this.iframeDoc,this.pageStyles);this.iframe.style.opacity=1;this.addEventListeners()}.bind(this)},addEventListeners:function(){var self=this;this.iframe.contentWindow.addEventListener("resize",_debounce(self.form.resize.bind(self.form)))}};var _applyPageStyles=function(doc,styles){var body=doc.getElementsByTagName("body")[0];for(var property in styles){if(!styles.hasOwnProperty(property)){return}body.style[property]=styles[property]}var buttons=doc.querySelectorAll(".button");var paragraphs=doc.getElementsByTagName("p");var bgColor;for(var i=0;i<buttons.length;i++){buttons[i].style["background-color"]=styles.anchorColor}};var _getStyle=function(node,property){var value;value=window.getComputedStyle(node,null).getPropertyValue(property);if(value===""||value==="transparent"||value==="rgba(0,0,0,0)"){return _getStyle(node.parentNode,property)}else{return value||""}};var _getBasicStyles=function(container){var anchor=document.createElement("a");var paragraph=document.createElement("p");container.appendChild(anchor);container.appendChild(paragraph);var styles={anchorColor:_getStyle(anchor,"color"),paragraphColor:_getStyle(paragraph,"color"),fontFamily:_getStyle(container,"font-family").replace(/['"]/g,"")};anchor.parentNode.removeChild(anchor);paragraph.parentNode.removeChild(paragraph);return styles};function _debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}module.exports=App},{"./comment_list.js":3,"./form.js":5}],5:[function(require,module,exports){var CommentList=require("./comment_list.js");var Comment=require("./comment.js");var Author=require("./author.js");var Form={init:function(iframe){this.iframe=iframe;this.DOM={};this.initDOM(this.iframe);this.fields=this.DOM.form.getElementsByTagName("form")[0].elements;this.commentsList=Object.create(CommentList);this.commentsList.init(this.DOM.form,this.renderCallback);this.author=Object.create(Author);this.author.fetch();this.addEventListeners();this.resize()},addEventListeners:function(){this.DOM.form.addEventListener("submit",this.onClick.bind(this));this.fields["text"].addEventListener("focus",this.onTextareaFocus.bind(this))},resize:function(){var formHeight=this.DOM.form.clientHeight;var margin=parseInt(window.getComputedStyle(this.DOM.form).marginBottom);var num=formHeight+margin+this.commentsList.getHeight()+20;this.iframe.style.height=num+"px"},initDOM:function(){this.doc=this.iframe.contentWindow.document;this.doc.write(_formTemplate);this.doc.close();this.DOM.form=this.doc.getElementById("ECForm");this.DOM.button=this.doc.getElementById("ECFormSubmit")},submit:function(){var comment=Object.create(Comment);this.author.init(this.fields["name"].value,this.fields["email"].value.trim());comment.init(this.author,this.fields["text"].value,(new Date).toString());if(comment.validate()){this.commentsList.comments.push(comment);this.commentsList.save();this.commentsList.render(this.DOM.form);this.author.save();this.clear()}else{this.showErrors(comment.errors)}this.resize()},showErrors:function(errors){errors.forEach(function(error){var msg=this.doc.createElement("p");msg.innerHTML=error.message;msg.classList.add("ec-error");this.fields[error.field].parentNode.appendChild(msg)}.bind(this))},onTextareaFocus:function(e){var fields=this.DOM.form.querySelectorAll(".ec-form__fields");fields[0].style.display="block";["name","email"].forEach(function(property){this.fields[property].value=this.author[property]||""}.bind(this));this.resize()},clear:function(){["text","name","email"].forEach(function(field){this.fields[field].value=""}.bind(this))},onClick:function(e){e.preventDefault();this.submit()}};var _formTemplate="<div id='ECForm' class='ec-form-wrapper'>"+"<h2 class='ec-heading--2' id='ECFormHeading'></h2>"+"<form class='ec-form'>"+"<div class='ec-form__field' id='ECForm-text'>"+"<textarea class='' name='text' id='ECFormField' placeholder='Your comment...'>"+"</textarea>"+"</div>"+"<div class='ec-form__fields'>"+"<div class='ec-form__field' id='ECForm-author'>"+"<input class='' type='text' name='name' placeholder='Name'>"+"</div>"+"<div class='ec-form__field' id='ECForm-email'>"+"<input class='' type='email' name='email' placeholder='Email'>"+"</div>"+"<div class=''>"+"<input class='button' id='ECFormSubmit' type='submit' value='Submit comment'>"+"</div>"+"</div>"+"</form>"+"</div>";module.exports=Form},{"./author.js":1,"./comment.js":2,"./comment_list.js":3}],6:[function(require,module,exports){var md5=function(string){function RotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2)}return WordToHexValue}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,3614090360);d=FF(d,a,b,c,x[k+1],S12,3905402710);c=FF(c,d,a,b,x[k+2],S13,606105819);b=FF(b,c,d,a,x[k+3],S14,3250441966);a=FF(a,b,c,d,x[k+4],S11,4118548399);d=FF(d,a,b,c,x[k+5],S12,1200080426);c=FF(c,d,a,b,x[k+6],S13,2821735955);b=FF(b,c,d,a,x[k+7],S14,4249261313);a=FF(a,b,c,d,x[k+8],S11,1770035416);d=FF(d,a,b,c,x[k+9],S12,2336552879);c=FF(c,d,a,b,x[k+10],S13,4294925233);b=FF(b,c,d,a,x[k+11],S14,2304563134);a=FF(a,b,c,d,x[k+12],S11,1804603682);d=FF(d,a,b,c,x[k+13],S12,4254626195);c=FF(c,d,a,b,x[k+14],S13,2792965006);b=FF(b,c,d,a,x[k+15],S14,1236535329);a=GG(a,b,c,d,x[k+1],S21,4129170786);d=GG(d,a,b,c,x[k+6],S22,3225465664);c=GG(c,d,a,b,x[k+11],S23,643717713);b=GG(b,c,d,a,x[k+0],S24,3921069994);a=GG(a,b,c,d,x[k+5],S21,3593408605);d=GG(d,a,b,c,x[k+10],S22,38016083);c=GG(c,d,a,b,x[k+15],S23,3634488961);b=GG(b,c,d,a,x[k+4],S24,3889429448);a=GG(a,b,c,d,x[k+9],S21,568446438);d=GG(d,a,b,c,x[k+14],S22,3275163606);c=GG(c,d,a,b,x[k+3],S23,4107603335);b=GG(b,c,d,a,x[k+8],S24,1163531501);a=GG(a,b,c,d,x[k+13],S21,2850285829);d=GG(d,a,b,c,x[k+2],S22,4243563512);c=GG(c,d,a,b,x[k+7],S23,1735328473);b=GG(b,c,d,a,x[k+12],S24,2368359562);a=HH(a,b,c,d,x[k+5],S31,4294588738);d=HH(d,a,b,c,x[k+8],S32,2272392833);c=HH(c,d,a,b,x[k+11],S33,1839030562);b=HH(b,c,d,a,x[k+14],S34,4259657740);a=HH(a,b,c,d,x[k+1],S31,2763975236);d=HH(d,a,b,c,x[k+4],S32,1272893353);c=HH(c,d,a,b,x[k+7],S33,4139469664);b=HH(b,c,d,a,x[k+10],S34,3200236656);a=HH(a,b,c,d,x[k+13],S31,681279174);d=HH(d,a,b,c,x[k+0],S32,3936430074);c=HH(c,d,a,b,x[k+3],S33,3572445317);b=HH(b,c,d,a,x[k+6],S34,76029189);a=HH(a,b,c,d,x[k+9],S31,3654602809);d=HH(d,a,b,c,x[k+12],S32,3873151461);c=HH(c,d,a,b,x[k+15],S33,530742520);b=HH(b,c,d,a,x[k+2],S34,3299628645);a=II(a,b,c,d,x[k+0],S41,4096336452);d=II(d,a,b,c,x[k+7],S42,1126891415);c=II(c,d,a,b,x[k+14],S43,2878612391);b=II(b,c,d,a,x[k+5],S44,4237533241);a=II(a,b,c,d,x[k+12],S41,1700485571);d=II(d,a,b,c,x[k+3],S42,2399980690);c=II(c,d,a,b,x[k+10],S43,4293915773);b=II(b,c,d,a,x[k+1],S44,2240044497);a=II(a,b,c,d,x[k+8],S41,1873313359);d=II(d,a,b,c,x[k+15],S42,4264355552);c=II(c,d,a,b,x[k+6],S43,2734768916);b=II(b,c,d,a,x[k+13],S44,1309151649);a=II(a,b,c,d,x[k+4],S41,4149444226);d=II(d,a,b,c,x[k+11],S42,3174756917);c=II(c,d,a,b,x[k+2],S43,718787259);b=II(b,c,d,a,x[k+9],S44,3951481745);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD)}var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase()};module.exports=md5},{}],7:[function(require,module,exports){var EchoChamber=function(window,undefined){var EchoChamber=window.EchoChamber||{};var hosts={local:"http://widget.dev/src",prod:"https://s3.amazonaws.com/echochamberjs/dist"};EchoChamber.host=hosts.prod;EchoChamber.App=require("./src/echo_chamber.js");var app=Object.create(EchoChamber.App);app.init();return app}(window)},{"./src/echo_chamber.js":4}]},{},[7]);
